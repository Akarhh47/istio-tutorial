<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zero Downtime Migrations :: Istio Workshop</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/istio-tutorial/workshop/istio-tutorial/1.4.x/advanced/zero-downtime-database.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/istio-tutorial/workshop">Istio Workshop</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="istio-tutorial"
  data-version="1.4.x" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Istio Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Introduction to Istio Tutorial</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../workshop/1setup.html">1. Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../2deploy-microservices.html">2. Deploy Microservices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../2deploy-microservices.html#deploycustomer">Deploy Customer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../2deploy-microservices.html#deploypreference">Deploy Preference</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../2deploy-microservices.html#deployrecommendation">Deploy Recommendation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../2deploy-microservices.html#redeployingcode">Updating Redeploying Code</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../3monitoring-tracing.html">3. Observability</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3monitoring-tracing.html#monitoring">Monitoring with Grafana</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3monitoring-tracing.html#prometheus">Prometheus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../3monitoring-tracing.html#tracing">Tracing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../3kiali.html">Kiali</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#howkiali">How Kiali Work</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#updatekiali">Update Kiali</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#generatingdata">Generating Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#servicegraph">Service Graph</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#servicelistening">Service Listening</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#istioconf">Istio Config</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#distributedtracing">Distributed Tracing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../3kiali.html#cleanup">Uninstall Kiali</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">4. Traffic Control</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../4simple-routerules.html">Simple Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../4simple-routerules.html#deployrecommendationv2">Deploy Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../4simple-routerules.html#istiorouting">Changing Istio Routings</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4simple-routerules.html#alltorecommendationv2">All Users To Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4simple-routerules.html#alltorecommendationv1">All Users To Recommendation V1</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4simple-routerules.html#alltorecommendationv1v2">All Users To Recommendation V1 and V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4simple-routerules.html#canarydeploymentrecommendation">Canary Deployment Between v1 And v2</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../4advanced-routerules.html">Advanced Routing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../4advanced-routerules.html#canarydeploymentuseragent">Canary Deployment based on user-agent</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4advanced-routerules.html#alltorecommendationv1">All Users To Recommendation V1</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4advanced-routerules.html#safaritov2">All Safari Users To Recommendation V2</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../4advanced-routerules.html#mobiletov2">All Mobile Users To Recommendation V2</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../4advanced-routerules.html#mirroringtraffic">Mirroring Traffic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../4advanced-routerules.html#loadbalancer">Load Balancer</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../5circuit-breaker.html">5. Service Resiliency</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5circuit-breaker.html#retry">Retry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../5circuit-breaker.html#timeout">Timeout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../5circuit-breaker.html#failfast">Fail Fast</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../5circuit-breaker.html#nocircuitbreaker">No Circuit Breaker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../5circuit-breaker.html#circuitbreaker">Circuit Breaker</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../6fault-injection.html">6. Chaos Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6fault-injection.html#503error">HTTP 503 Error</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../6fault-injection.html#delay">Delay</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">7. Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../8egress.html">Egress</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8egress.html#createrecommendationv3">Create Recommendation V3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8egress.html#istioegress">Istio-ize Egress</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../8acl.html">Access Control List</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8acl.html#whitelist">White List</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8acl.html#blacklist">Black List</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../8mTLS.html">Mutual TLS and Istio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8mTLS.html#testingtls">Testing mTLS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../8jwt.html">End-user authentication with JWT</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8jwt.html#enablingauthentication">Enabling end-user authentication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8jwt.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../8rbac.html">Istio Role Based Access Control (RBAC)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8rbac.html#enabling-rbac">Enabling RBAC</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8rbac.html#authorization-jwt">Authorization and JWT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8rbac.html#final-notes">Final Notes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../8rbac.html#cleanup">Clean Up</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#">8tips.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Istio Tutorial</a></li>
    <li class="crumb"><a href="zero-downtime-database.html">Zero Downtime Migrations</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Zero Downtime Migrations</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Before Start</div>
<div class="paragraph">
<p>You should have NO virtualservice, destinationrule, gateway or policy (in <code>tutorial</code> namespace) <code>kubectl get virtualservice</code> <code>kubectl get destinationrule</code> <code>kubectl get gateway</code> <code>kubectl get policy</code>
if so run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./scripts/clean.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, you need to undeploy any <em>recommendation</em> service (v1, v2, v3) that you might have deployed on the cluster.
To undeploy them just run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete all -l app=recommendation -n tutorial
or
kubectl delete all -l app=recommendation -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait until all <em>recommendation</em> serivces are down.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods -n tutorial
or
kubectl get pods -n tutorial

NAME                                  READY     STATUS    RESTARTS   AGE
customer-3600192384-fpljb             2/2       Running   0          17m
preference-243057078-8c5hz           2/2       Running   0          15m</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Old Versions of customer and preference</div>
<div class="paragraph">
<p>To run this section you need to deploy the latest <em>customer</em> and <em>preference</em> versions, if you already have these <strong>old</strong> versions of <em>customer</em> and <em>preference</em>, deploy them again with latest sources following <a href="../2deploy-microservices.html" class="page">Deploy Microservices</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="recommendationv4"><a class="anchor" href="#recommendationv4"></a>Deploy recommendation:v4</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_deploy_postgresql_database"><a class="anchor" href="#_deploy_postgresql_database"></a>Deploy PostgreSQL database</h3>
<div class="paragraph">
<p>The first thing you need to do is deploy a PostgreSQL database server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd recommendation/java/vertx

oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/PostgreSQL-deployment.yml">../../kubernetes/PostgreSQL-deployment.yml</a>) -n tutorial
or
kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/PostgreSQL-deployment.yml">../../kubernetes/PostgreSQL-deployment.yml</a>) -n tutorial

oc create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/PostgreSQL-service.yml">../../kubernetes/PostgreSQL-service.yml</a> -n tutorial
or
kubectl create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/PostgreSQL-service.yml">../../kubernetes/PostgreSQL-service.yml</a> -n tutorial

# Wait until PotsgresSQL deployed

oc get pods -w -n tutorial
or
kubectl get pods -w -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inspecting_database_changes"><a class="anchor" href="#_inspecting_database_changes"></a>Inspecting Database Changes</h3>
<div class="paragraph">
<p>I recommend that every time you deploy a new <em>recommendation</em> service version or you do a <code>POST</code> call, you inspect how the database (<em>recommendation</em> table) has changed.</p>
</div>
<div class="paragraph">
<p>To do it, you just need to go inside into the <em>postgres</em> container and use <code>psql</code> tool.
Open a new terminal window and run next commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pods
or
kubectl get pods

NAME                                 READY     STATUS    RESTARTS   AGE
customer-7dcd544ff9-5j6ml            2/2       Running   0          22m
postgres-6cc7c8bbd5-jqw8r            2/2       Running   0          31m
preference-v1-7f7ddf6c4-fhjtw        2/2       Running   0          21m

kubectl exec -ti postgres-6cc7c8bbd5-jqw8r -c postgres /bin/bash</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, when you are inside the container, you can inspect database changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">psql -U admin recommendation

recommendation=# select * from recommendation;

 id |           name
----+--------------------------
  1 | Star Wars: A New Hope
  2 | Star Trek: First Contact
(2 rows)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_recommendationv4"><a class="anchor" href="#_create_recommendationv4"></a>Create recommendation:v4</h3>
<div class="paragraph">
<p>To create <em>recommendation v4</em>, we need to change one line in <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/java/vertx/pom.xml">pom.xml</a>) of project, and change configuration part from <code>vertx-maven-plugin</code>:</p>
</div>
<div class="paragraph">
<p>Before:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
    &lt;verticle&gt;com.redhat.developer.demos.recommendation.RecommendationVerticle&lt;/verticle&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
    &lt;verticle&gt;com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle&lt;/verticle&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_docker_build_if_you_have_access_to_docker_daemon"><a class="anchor" href="#_docker_build_if_you_have_access_to_docker_daemon"></a>Docker build (if you have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package

docker build -t example/recommendation:v4 .

docker images | grep recommendation
example/recommendation                  v4                  b23e37349009        1 minutes ago       438MB
example/recommendation                  v2                  c31e399a9628        5 minutes ago       438MB
example/recommendation                  v1                  f072978d9cf6        8 minutes ago      438MB</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We have a 4th Deployment to manage the v4 version of recommendation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v4.yml">../../kubernetes/Deployment-v4.yml</a>) -n tutorial
oc get pods -w -n tutorial

or

kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v4.yml">../../kubernetes/Deployment-v4.yml</a>) -n tutorial
kubectl get pods -w -n tutorial

oc create -f ../../kubernetes/Service.yml
or
kubectl create -f ../../kubernetes/Service.yml</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon"><a class="anchor" href="#_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon"></a>OpenShift S2I strategy (if you DON&#8217;T have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package -f recommendation/java/vertx
oc new-app -l app=recommendation,version=v4 --name=recommendation-v4 --context-dir=recommendation/java/vertx -e JAEGER_SERVICE_NAME=recommendation JAEGER_ENDPOINT=http://jaeger-collector.istio-system.svc:14268/api/traces JAEGER_PROPAGATION=b3 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1 JAVA_OPTIONS='-Xms128m -Xmx256m -Djava.net.preferIPv4Stack=true' fabric8/s2i-java~https://github.com/redhat-developer-demos/istio-tutorial -o yaml  &gt; recommendation-v4.yml
oc apply -f &lt;(istioctl kube-inject -f recommendation-v4.yml) -n tutorial
oc cancel-build bc/recommendation-v4 -n tutorial
oc delete svc/recommendation-v4 -n tutorial
oc start-build recommendation-v4 --from-dir=. --follow -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wait_for_v4_to_be_deployed"><a class="anchor" href="#_wait_for_v4_to_be_deployed"></a>Wait for v4 to be deployed</h4>
<div class="paragraph">
<p>Wait for those pods to show "2/2", the istio-proxy/envoy sidecar is part of that pod</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                  READY     STATUS    RESTARTS   AGE
customer-3600192384-fpljb             2/2       Running   0          17m
preference-243057078-8c5hz           2/2       Running   0          15m
recommendation-v4-60483540-9snd9     2/2       Running   0          12m</code></pre>
</div>
</div>
<div class="paragraph">
<p>and test the customer endpoint</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

recommendation v4 [Star Wars: A New Hope,Star Trek: First Contact] from '60483540-9snd9': 1</code></pre>
</div>
</div>
<div class="paragraph">
<p>What you are getting here is a list of recommendations (every time will be the same) which are selected from the database, so it means that any change on the database is reflected to this query.</p>
</div>
<div class="paragraph">
<p>For example, run next command to add a new recommendation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -H "Content-type: text/plain" -X POST --data "Avengers: Infinity War" customer-tutorial.$(minishift ip).nip.io
3</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t see an integer but a normal GET (<code>customer &#8658; preference &#8658; recommendation v4 [Star Wars: A New Hope,Star Trek: First Contact] from '6d4b86c9fb-ph8rm': 2</code>) this is because you have old versions of customer and preference services deployed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And make a new request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

recommendation v4 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War] from '60483540-9snd9': 2</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration"><a class="anchor" href="#migration"></a>Start the migration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What we want to do is one of the most complex operations in terms of database migration, and this is changing the name of a column.
The same process is used for example if you need to change a data type, and it is similar in case of having to add new columns or tables.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Flyway</div>
<div class="paragraph">
<p><a href="https://flywaydb.org/">Flyway</a> is a version control for your database.
It allows you to evolute your database schema (and data) with ease and pleasure.</p>
</div>
<div class="paragraph">
<p>Flyway allows you to have your database migration files altogether with your code.
In summary, any SQL file placed following <em>Flyway_</em> naming convention at <code>src/main/resources/db/migration</code> are executed against a configured database if it has not applied before.</p>
</div>
<div class="paragraph">
<p>And this is the solution used in the <em>recommendation</em> service for dealing with database migrations.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The steps we are going to follow for the migration is by doing 3 versions of the service:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For sake of simplicity we are going to change the major number of the version, but in a real case, you&#8217;ll make it using minor/patch versions.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a new column and make the new service read from the old column and write to both.</p>
</li>
<li>
<p>Copy old data to the new column and code reads from the new column and writes to both.</p>
</li>
<li>
<p>The code reads and writes from the new column.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can create subversions (i.e one version for adding the column, another for making the new service read from old column and write to both) depending on your release process.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to follow these steps (no shortcuts) to make your application safe to any rollback in case of an error in the newer version.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So let&#8217;s see the process of updating the column named <em>name</em> to <em>movie_name</em>.</p>
</div>
<div class="sect2">
<h3 id="recommendationv5"><a class="anchor" href="#recommendationv5"></a>Recommendation:v5</h3>
<div class="paragraph">
<p>The first thing to do before releasing <em>recommendation</em> v5 is to add the new column (which would be the final name, in this case, <strong>movie_name</strong>).
To do it execute next command on a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/java/vertx/src/main/sql/V2__Add_movie_column_in_recommendation_table.sql">src/main/sql/V2__Add_movie_column_in_recommendation_table.sql</a> src/main/resources/db/migration/V2__Add_movie_column_in_recommendation_table.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then update the <em>recommendation</em> service to a newer version and to write new values to both columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String RESPONSE_STRING_FORMAT = "recommendation v5 from '%s': %d\n";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <code>RecommendationPersistenceVerticle</code> class and change <code>start</code> method form:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">router.post("/").handler(this::addRecommendation);
// router.post("/").handler(this::addRecommendationToBothColumns);</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// router.post("/").handler(this::addRecommendation);
router.post("/").handler(this::addRecommendationToBothColumns);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then let&#8217;s build the new version and deploy it to the cluster.</p>
</div>
<div class="sect3">
<h4 id="_docker_build_if_you_have_access_to_docker_daemon_2"><a class="anchor" href="#_docker_build_if_you_have_access_to_docker_daemon_2"></a>Docker build (if you have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package

docker build -t example/recommendation:v5 .

docker images | grep recommendation
example/recommendation                  v5                  a84563734376        1 minutes ago       438MB
example/recommendation                  v4                  b23e37349009        1 minutes ago       438MB
example/recommendation                  v2                  c31e399a9628        5 minutes ago       438MB
example/recommendation                  v1                  f072978d9cf6        8 minutes ago      438MB</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We have a 5th Deployment to manage the v4 version of recommendation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v5.yml">../../kubernetes/Deployment-v5.yml</a>) -n tutorial
oc get pods -w -n tutorial

or

kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v5.yml">../../kubernetes/Deployment-v5.yml</a>) -n tutorial
kubectl get pods -w -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_2"><a class="anchor" href="#_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_2"></a>OpenShift S2I strategy (if you DON&#8217;T have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package -f recommendation/java/vertx
oc new-app -l app=recommendation,version=v5 --name=recommendation-v5 --context-dir=recommendation/java/vertx -e JAEGER_SERVICE_NAME=recommendation JAEGER_ENDPOINT=http://jaeger-collector.istio-system.svc:14268/api/traces JAEGER_PROPAGATION=b3 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1 JAVA_OPTIONS='-Xms128m -Xmx256m -Djava.net.preferIPv4Stack=true' fabric8/s2i-java~https://github.com/redhat-developer-demos/istio-tutorial -o yaml  &gt; recommendation-v5.yml
oc apply -f &lt;(istioctl kube-inject -f recommendation-v5.yml) -n tutorial
oc cancel-build bc/recommendation-v5 -n tutorial
oc delete svc/recommendation-v5 -n tutorial
oc start-build recommendation-v5 --from-dir=. --follow -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wait_for_v5_to_be_deployed"><a class="anchor" href="#_wait_for_v5_to_be_deployed"></a>Wait for v5 to be deployed</h4>
<div class="paragraph">
<p>Wait for those pods to show "2/2", the istio-proxy/envoy sidecar is part of that pod</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                  READY     STATUS    RESTARTS   AGE
customer-3600192384-fpljb             2/2       Running   0          17m
preference-243057078-8c5hz           2/2       Running   0          15m
recommendation-v4-60483540-9snd9     2/2       Running   0          12m
recommendation-v5-00979354-89fga     2/2       Running   0          11m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blue_green_deployment_between_v4_and_v5"><a class="anchor" href="#_blue_green_deployment_between_v4_and_v5"></a>Blue-Green Deployment between v4 and v5</h4>
<div class="paragraph">
<p>Now we can start the release process of <em>recommendation</em> v5.
Let&#8217;s redirect all traffic to v4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/destination-rule-recommendation-v4-v5-v6-v7.yml">../../../istiofiles/destination-rule-recommendation-v4-v5-v6-v7.yml</a> -n tutorial
istioctl create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v4.yml">../../../istiofiles/virtual-service-recommendation-v4.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

recommendation v4 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War] from '60483540-9snd9': 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s redirect traffic to v5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v5.yml">../../../istiofiles/virtual-service-recommendation-v5.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>And apply some requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io
recommendation v5 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War] from '00979354-89fga': 1

curl -H "Content-type: text/plain" -X POST --data "Frozen" customer-tutorial.$(minishift ip).nip.io
3

curl customer-tutorial.$(minishift ip).nip.io
recommendation v5 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen] from '00979354-89fga': 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s happening if we find some problems in <em>v5</em> ? We just need to redirect traffic back to v4.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v4.yml">istiofiles/virtual-service-recommendation-v4.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

recommendation v4 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen] from '60483540-9snd9': 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that even though, it is the old version, the content added during v5 was released is still available and no data lost has ocurred.
Next step (executed by DB administrator) could be just removing the <strong>movie_name</strong> column.</p>
</div>
<div class="paragraph">
<p>But let&#8217;s suppose that <em>v5</em> has no errors and it is going to be the correct release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v5.yml">istiofiles/virtual-service-recommendation-v5.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can undeploy the <em>recommendation</em> v4 service from the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete all -l app=recommendation,version=v4
or
kubectl delete all -l app=recommendation,version=v4</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recommendationv6"><a class="anchor" href="#recommendationv6"></a>Recommendation:v6</h3>
<div class="paragraph">
<p>The first thing to do before releasing <em>recommendation</em> v6 is to copy old data (<strong>name</strong> column) to the new column (<strong>movie_name</strong>).
Usually, if the column contains a lot of entries, you&#8217;ll do it using a batch process, but for the sake of simplicity, a simple SQL update is executed in this case.
To do it execute next command on a terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/java/vertx/src/main/sql/V3__Update_recommendation_data.sql">src/main/sql/V3__Update_recommendation_data.sql</a> src/main/resources/db/migration/V3__Update_recommendation_data.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then update code so the reads are happening from the new column and write to both.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String RESPONSE_STRING_FORMAT = "recommendation v6 from '%s': %d\n";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <code>RecommendationPersistenceVerticle</code> class and change <code>getRecommendationsFromDb</code> method form:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final List&lt;String&gt; recommendations = findRecommendation(resultSet);
// final List&lt;String&gt; recommendations = findRecommendationNew(resultSet);</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// final List&lt;String&gt; recommendations = findRecommendation(resultSet);
final List&lt;String&gt; recommendations = findRecommendationNew(resultSet);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then let&#8217;s build the new version and deploy it to the cluster.</p>
</div>
<div class="sect3">
<h4 id="_docker_build_if_you_have_access_to_docker_daemon_3"><a class="anchor" href="#_docker_build_if_you_have_access_to_docker_daemon_3"></a>Docker build (if you have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package

docker build -t example/recommendation:v6 .

docker images | grep recommendation
example/recommendation                  v6                  345bb6773434        1 minutes ago       438MB
example/recommendation                  v5                  a84563734376        1 minutes ago       438MB
example/recommendation                  v4                  b23e37349009        1 minutes ago       438MB
example/recommendation                  v2                  c31e399a9628        5 minutes ago       438MB
example/recommendation                  v1                  f072978d9cf6        8 minutes ago      438MB</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We have a 6th Deployment to manage the v4 version of recommendation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v6.yml">../../kubernetes/Deployment-v6.yml</a>) -n tutorial
oc get pods -w -n tutorial

or

kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v6.yml">../../kubernetes/Deployment-v6.yml</a>) -n tutorial
kubectl get pods -w -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_3"><a class="anchor" href="#_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_3"></a>OpenShift S2I strategy (if you DON&#8217;T have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package -f recommendation/java/vertx
oc new-app -l app=recommendation,version=v6 --name=recommendation-v6 --context-dir=recommendation/java/vertx -e JAEGER_SERVICE_NAME=recommendation JAEGER_ENDPOINT=http://jaeger-collector.istio-system.svc:14268/api/traces JAEGER_PROPAGATION=b3 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1 JAVA_OPTIONS='-Xms128m -Xmx256m -Djava.net.preferIPv4Stack=true' fabric8/s2i-java~https://github.com/redhat-developer-demos/istio-tutorial -o yaml  &gt; recommendation-v6.yml
oc apply -f &lt;(istioctl kube-inject -f recommendation-v6.yml) -n tutorial
oc cancel-build bc/recommendation-v6 -n tutorial
oc delete svc/recommendation-v6 -n tutorial
oc start-build recommendation-v6 --from-dir=. --follow -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wait_for_v6_to_be_deployed"><a class="anchor" href="#_wait_for_v6_to_be_deployed"></a>Wait for v6 to be deployed</h4>
<div class="paragraph">
<p>Wait for those pods to show "2/2", the istio-proxy/envoy sidecar is part of that pod</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                  READY     STATUS    RESTARTS   AGE
customer-3600192384-fpljb             2/2       Running   0          17m
preference-243057078-8c5hz           2/2       Running   0          15m
recommendation-v5-00979354-89fga     2/2       Running   0          11m
recommendation-v6-98b29894-64g45     2/2       Running   0          11m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blue_green_deployment_between_v5_and_v6"><a class="anchor" href="#_blue_green_deployment_between_v5_and_v6"></a>Blue-Green Deployment between v5 and v6</h4>
<div class="paragraph">
<p>Now, let&#8217;s redirect traffic to v6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v6.yml">istiofiles/virtual-service-recommendation-v6.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>And apply some requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io
recommendation v6 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen] from '98b29894-64g45': 3

curl -H "Content-type: text/plain" -X POST --data "The Lord Of The Rings: The Fellowship of the Ring" customer-tutorial.$(minishift ip).nip.io
5

curl customer-tutorial.$(minishift ip).nip.io
recommendation v6 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring] from '98b29894-64g45': 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s happening if we find some problems in <em>v6</em> ? We just need to redirect traffic back to v5.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v5.yml">istiofiles/virtual-service-recommendation-v5.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

recommendation v5 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring] from '00979354-89fga': 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>So again no data lost and rolling back the service has no consequences.</p>
</div>
<div class="paragraph">
<p>But let&#8217;s suppose that <em>v6</em> has no errors and it is going to be the correct release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v6.yml">istiofiles/virtual-service-recommendation-v6.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we can undeploy the <em>recommendation</em> v5 service from the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete all -l app=recommendation,version=v5
or
kubectl delete all -l app=recommendation,version=v5</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recommendationv7"><a class="anchor" href="#recommendationv7"></a>Recommendation:v7</h3>
<div class="paragraph">
<p>The last thing to do is just write every time to the new column <strong>movie_name</strong> and not both.
Also, it implies removing the null constraint and add it to the new column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/java/vertx/src/main/sql/V4__Update_movie_name_constraints.sql">src/main/sql/V4__Update_movie_name_constraints.sql</a> src/main/resources/db/migration/V4__Update_movie_name_constraints.sql</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String RESPONSE_STRING_FORMAT = "recommendation v7 from '%s': %d\n";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open <code>RecommendationPersistenceVerticle</code> class and change <code>getRecommendationsFromDb</code> method form:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">router.post("/").handler(this::addRecommendationToBothColumns);
// router.post("/").handler(this::addRecommendationToNewColumn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// router.post("/").handler(this::addRecommendationToBothColumns);
router.post("/").handler(this::addRecommendationToNewColumn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then let&#8217;s build the new version and deploy it to the cluster.</p>
</div>
<div class="sect3">
<h4 id="_docker_build_if_you_have_access_to_docker_daemon_4"><a class="anchor" href="#_docker_build_if_you_have_access_to_docker_daemon_4"></a>Docker build (if you have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package

docker build -t example/recommendation:v7 .

docker images | grep recommendation
example/recommendation                  v7                  f449867a2342        2 minutes ago       438MB
example/recommendation                  v6                  345bb6773434        3 minutes ago       438MB
example/recommendation                  v5                  a84563734376        8 minutes ago       438MB
example/recommendation                  v4                  b23e37349009        9 minutes ago       438MB
example/recommendation                  v2                  c31e399a9628        12 minutes ago       438MB
example/recommendation                  v1                  f072978d9cf6        15 minutes ago      438MB</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We have a 7th Deployment to manage the v4 version of recommendation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v7.yml">../../kubernetes/Deployment-v7.yml</a>) -n tutorial
oc get pods -w -n tutorial

or

kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v7.yml">../../kubernetes/Deployment-v7.yml</a>) -n tutorial
kubectl get pods -w -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_4"><a class="anchor" href="#_openshift_s2i_strategy_if_you_dont_have_access_to_docker_daemon_4"></a>OpenShift S2I strategy (if you DON&#8217;T have access to Docker daemon)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean package -f recommendation/java/vertx
oc new-app -l app=recommendation,version=v7 --name=recommendation-v7 --context-dir=recommendation/java/vertx -e JAEGER_SERVICE_NAME=recommendation JAEGER_ENDPOINT=http://jaeger-collector.istio-system.svc:14268/api/traces JAEGER_PROPAGATION=b3 JAEGER_SAMPLER_TYPE=const JAEGER_SAMPLER_PARAM=1 JAVA_OPTIONS='-Xms128m -Xmx256m -Djava.net.preferIPv4Stack=true' fabric8/s2i-java~https://github.com/redhat-developer-demos/istio-tutorial -o yaml  &gt; recommendation-v7.yml
oc apply -f &lt;(istioctl kube-inject -f recommendation-v7.yml) -n tutorial
oc cancel-build bc/recommendation-v7 -n tutorial
oc delete svc/recommendation-v7 -n tutorial
oc start-build recommendation-v7 --from-dir=. --follow -n tutorial</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_wait_for_v7_to_be_deployed"><a class="anchor" href="#_wait_for_v7_to_be_deployed"></a>Wait for v7 to be deployed</h4>
<div class="paragraph">
<p>Wait for those pods to show "2/2", the istio-proxy/envoy sidecar is part of that pod</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NAME                                  READY     STATUS    RESTARTS   AGE
customer-3600192384-fpljb             2/2       Running   0          17m
preference-243057078-8c5hz           2/2       Running   0          15m
recommendation-v6-98b29894-64g45     2/2       Running   0          11m
recommendation-v7-bb452a56-45tg2     2/2       Running   0          10m</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_blue_green_deployment_between_v6_and_v7"><a class="anchor" href="#_blue_green_deployment_between_v6_and_v7"></a>Blue-Green Deployment between v6 and v7</h4>
<div class="paragraph">
<p>Now, let&#8217;s redirect traffic to v7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v7.yml">istiofiles/virtual-service-recommendation-v7.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>And apply some requests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io
recommendation v7 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring] from 'bb452a56-45tg2': 4

curl -H "Content-type: text/plain" -X POST --data "Howl's Moving Castle" customer-tutorial.$(minishift ip).nip.io
6

curl customer-tutorial.$(minishift ip).nip.io
recommendation v7 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring, Howl's Moving Castle] from 'bb452a56-45tg2': 5</code></pre>
</div>
</div>
<div class="paragraph">
<p>What&#8217;s happening if we find some problems in <em>v7</em> ? We just need to redirect traffic back to v6.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v6.yml">istiofiles/virtual-service-recommendation-v6.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io

curl customer-tutorial.$(minishift ip).nip.io
recommendation v6 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring, Howl's Moving Castle] from '98b29894-64g45': 6

curl -H "Content-type: text/plain" -X POST --data "The Pink Panther" customer-tutorial.$(minishift ip).nip.io
7</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now v7 is fixed and released again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">istioctl replace -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/istiofiles/virtual-service-recommendation-v7.yml">istiofiles/virtual-service-recommendation-v7.yml</a> -n tutorial</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl customer-tutorial.$(minishift ip).nip.io
recommendation v6 [Star Wars: A New Hope,Star Trek: First Contact, Avengers: Infinity War, Frozen, The Lord Of The Rings: The Fellowship of the Ring, Howl's Moving Castle, The Pink Panther] from '98b29894-64g45': 7</code></pre>
</div>
</div>
<div class="paragraph">
<p>So no data lose, every step we follow is safe, and at any time we are able to roll back to last known working version without any problem and when the new version is released again, everything still works.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="finalstep"><a class="anchor" href="#finalstep"></a>Final Step</h3>
<div class="paragraph">
<p>The final step that should be done by a DB administrator for example when maintenance window is set, and it is to delete the old column since the new version of the service is not using it anymore for reading nor for writing.
Keep in mind that this is a destructive operation so, it should be taken with care.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cleanup"><a class="anchor" href="#cleanup"></a>Cleanup</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete all -l app=recommendation
or
kubectl delete all -l app=recommendation

oc delete all -l app=postgres
or
kubectl delete all -l app=postgres

istioctl delete -f istiofiles/destination-rule-recommendation-v4-v5-v6-v7.yml -n tutorial
istioctl create -f istiofiles/virtual-service-recommendation-v7.yml -n tutorial</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then let&#8217;s redeploy <em>recommendation</em> v1 and v2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd recommendation/java/vertx

oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v1.yml">../../kubernetes/Deployment-v1.yml</a>) -n tutorial
or
kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v1.yml">../../kubernetes/Deployment-v1.yml</a>) -n tutorial

oc apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v2.yml">../../kubernetes/Deployment-v2.yml</a>) -n tutorial
or
kubectl apply -f &lt;(istioctl kube-inject -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Deployment-v2.yml">../../kubernetes/Deployment-v2.yml</a>) -n tutorial

oc create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Service.yml">../../kubernetes/Service.yml</a>
oc get pods -w
or
kubectl create -f <a href="https://github.com/redhat-developer-demos/istio-tutorial/blob/master/recommendation/kubernetes/Service.yml">../../kubernetes/Service.yml</a>
kubectl get pods -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to rollback the code of <em>recommendation</em> service to initial stages, you need to do next changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Rollback code changes in <code>RecommendationPersistenceVerticle</code> class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// final List&lt;String&gt; recommendations = findRecommendation(resultSet);
final List&lt;String&gt; recommendations = findRecommendationNew(resultSet);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final List&lt;String&gt; recommendations = findRecommendation(resultSet);
// final List&lt;String&gt; recommendations = findRecommendationNew(resultSet);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And from:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// router.post("/").handler(this::addRecommendation);
// router.post("/").handler(this::addRecommendationToBothColumns);
router.post("/").handler(this::addRecommendationToNewColumn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">router.post("/").handler(this::addRecommendation);
router.post("/").handler(this::addRecommendationToBothColumns);
// router.post("/").handler(this::addRecommendationToNewColumn);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And from:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String RESPONSE_STRING_FORMAT = "recommendation v7 from '%s': %d\n";</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="title">com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String RESPONSE_STRING_FORMAT = "recommendation v4 from '%s': %d\n";</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove next SQL scripts:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm src/main/resources/db/migration/V2__Add_movie_column_in_recommendation_table.sql
rm src/main/resources/db/migration/V3__Update_recommendation_data.sql
rm src/main/resources/db/migration/V4__Update_movie_name_constraints.sql</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set correct verticle:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
    &lt;verticle&gt;com.redhat.developer.demos.recommendation.RecommendationPersistenceVerticle&lt;/verticle&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;configuration&gt;
    &lt;verticle&gt;com.redhat.developer.demos.recommendation.RecommendationVerticle&lt;/verticle&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
  <ul class="rhd-menu">
    <li class="menu-item menu-item--expanded">
      <h3 class="section-toggle">Resources</h3>
      <ul class="rhd-menu">
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/istio-tutorial" title="Istio Tutorial">Istio
            Tutorial</a>
        </li>
        <li class="menu-item">
          <a href="https://github.com/redhat-developer-demos/istio-tutorial/issues" title="Issue Tracker">Issue
            Tracker</a>
        </li>
      </ul>
    </li>
  </ul>
</nav>      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
